/*!
 * auhtor: Luis Eduardo Miranda Barja
 * (C) 2015 - mbarjaedu13@gmail.com
 */
$(function(){$(".pregnant-menu").addClass("active");$("#back, .back").on({click:function(m){m.preventDefault();location.href="/embarazos/gestion?id_per="+$("input[name=id_per]").val();}});$("input[name=f_nac]").mask("99/99/9999").on({"click focusin":function(m){$(this).datetimepicker({locale:"es",format:"DD/MM/YYYY"});}});var f=$("form").data("key"),e=function(n){var p=[$('<option value="-1">-- Elija Una --</option>')];for(var q=0;q<n.length;q++){var o=n[q],m=$("<option/>",{value:o.id_etn,text:o.nombre});if(o.id_etn==f.id_etn){m.attr("selected",true);}p.push(m);}return p;},j=function(m){var n=[$('<option value="-1">-- Elija Una --</option>')];for(var o=0;o<m.length;o++){var q=m[o],p=$("<option/>",{value:q.id_red,text:q.nombre}).data("municipios",q.municipios);if(f.id_red==q.id_red){p.attr("selected",true);}n.push(p);}return n;},d=function(q){var n=[$('<option value="-1">-- Elija Uno --</option>')];for(var p=0;p<q.length;p++){var o=q[p],m=$("<option/>",{value:o.id_mup,text:o.nombre}).data("comunidades",o.comunidades);if(f.id_mup==o.id_mup){m.attr("selected",true);}n.push(m);}return n;},b=function(q){var o=[$('<option value="-1">-- Elija Uno --</option>')];for(var p=0;p<q.length;p++){var n=q[p],m=$("<option/>",{value:n.id_com,text:n.nombre});if(f.id_com==n.id_com){m.attr("selected",true);}o.push(m);}return o;};if(f.is_pregnant){$.post("/etnias/disponibles",data={_xsrf:getCookie("_xsrf")},function(m){$("#etnia").html(e(m));});$.post("/redes_salud/geografia",data={_xsrf:$("input[name=_xsrf]").val()},function(m){$("#red").html(j(m)).on({change:function(){var o=+$(this).val(),n=$(this).find('option[value="'+o+'"]').data("municipios");if(o>0){$("#municipio").html(d(n)).on({change:function(){var p=+$(this).val();if(p>0){comunidades=$(this).find('option[value="'+p+'"]').data("comunidades");$("#comunidad").html(b(comunidades));}else{$("#comunidad").html('<option value="-1">-- Elija Una --</option>');}}}).change();}else{$("#municipio").html('<option value="-1">-- Elija Uno --</option>');$("#comunidad").html('<option value="-1">-- Elija Una --</option>');}}}).change();});}else{$(".locations").disable().hide();}var c=+$("input[name=telf]").val(),g=$("input[name=c_telf]").val(),h=$("input[name=ci]").val(),l=$("input[name=c_id_per]").val(),k=$("input[name=c_nombres]").val(),a=$("input[name=c_apellidos]").val(),i=$("select[name=c_sexo]").val();$("input[name=telf]").on({blur:function(n){var o=$(this),m=$(this).val();if(c!=+m&&m.length==8&&m.match(o.data("pattern"))){if(m!=g){$.post("/personas/v_telf",data={_xsrf:$("input[name=_xsrf]").val(),telf:m},function(p){if(p){o.val(c).focus().closest(".form-group").removeClass("has-success has-error");swal({title:"Error!",text:"El nro. "+m+", está registrado!.\nPor favor use otro.",type:"error",confirmButtonText:"Continuar",});}});}else{o.val(c).focus().closest(".form-group").removeClass("has-success has-error");}}}});$("input[name=c_telf]").on({keyup:function(n){var o=$(this),m=o.val();$("input[name=c_id_per]").enable().val(l);if(m.length==8&&m!=g&&m.match(o.data("pattern"))){if(m!=c){$("form").find(".optional").enable().show();swal({title:"Advertencia!",text:"Desea cambiar de contacto?",type:"warning",showCancelButton:true,cancelButtonText:"Cancelar",confirmButtonText:"Cambiar",closeOnConfirm:true},function(){$("form").find(".optional").show().end().find(".contact-name").text("Contacto");$.post("/personas/v_telf",data={_xsrf:$("input[name=_xsrf]").val(),telf:m},function(p){if(p){$.post("/personas/getbycellphone",data={_xsrf:getCookie("_xsrf"),telf:m},function(q){l=q.id_per;k=q.nombres;a=q.apellidos;$("input[name=c_nombres]").val(q.nombres);$("input[name=c_apellidos]").val(q.apellidos);$("input[name=c_id_per]").enable().val(q.id_per);$("form").find(".optional").disable().hide().end().find(".contact-name").text(q.persona);$("select[name=c_sexo]").find("option:selected").removeAttr("selected").end().find('option[value="'+q.sexo+'"]').attr("selected",true).select();});}else{$("input[name=c_id_per]").disable();$("form").find(".optional").enable().show();$("input[name=c_nombres], input[name=c_apellidos]").val("");$("select[name=c_sexo]").find("option:selected").removeAttr("selected").end().find('option[value="-1"]').attr("selected",true).select();}});});}else{$("form").find(".optional").enable().show().end().find(".contact-name").text("Contacto");o.val(g).focus().closest(".form-group").removeClass("has-success has-error").find("span").removeClass("fa-check fa-times");swal({title:"Error!",text:"El nro. de contacto, no puede ser igual al de la embarazada!.\nPor favor elija otro.",type:"error",confirmButtonText:"Continuar",});}}else{if(m.length==8){o.val(g).closest(".form-group").removeClass("has-success has-error").find("span").removeClass("fa-check fa-times");$("input[name=c_id_per]").enable();$("form").find(".optional").enable().show().end().find(".contact-name").text("Contacto");$("input[name=c_nombres]").val(k);$("input[name=c_apellidos]").val(a);$("select[name=c_sexo]").find("option:selected").removeAttr("selected").end().find('option[value="'+i+'"]').attr("selected",true).select();}else{o.closest(".form-group").removeClass("has-success").addClass("has-error").find("span").removeClass("fa-check").addClass("fa-times");}}}});h=h.length==8?h:"";$("input[name=ci]").on({blur:function(o){var n=$(this),m=$(this).val();if(m.length>=7&&m.length<=8&&m!=h){$.post("/personas/v_ci",data={_xsrf:getCookie("_xsrf"),ci:n.val()},function(p){if(p){n.val(h).focus().closest(".form-group").removeClass("has-success has-error");swal({title:"Error!",text:"El CI: "+m+", está registrado!.\nPor favor use otro.",type:"error",confirmButtonText:"Continuar",});}else{n.closest(".form-group").removeClass("has-error").addClass("has-success").find("span").removeClass("fa-times").addClass("fa fa-check");}});}}});$("form").on({submit:function(o){o.preventDefault();o.stopPropagation();var m=$(this),n=$(this).find("button[type=submit]");n.disable().hide();$.post("/embarazadas/modificar_embarazada",data=m.form2Dict(),function(p){if(p){location.href="/embarazos/gestion?id_per="+$("input[name=id_per]").val();}else{n.enable().show();var q=$("input[name=c_telf]");$.post("/personas/v_telf",data={_xsrf:$("input[name=_xsrf]").val(),telf:q.val()},function(r){if(r){swal({title:"Error!",text:"El nro. "+q.val()+", está registrado!.\nPor favor elija otro.",type:"error",confirmButtonText:"Continuar",closeOnConfirm:true,});q.val(g);}});}});}});});