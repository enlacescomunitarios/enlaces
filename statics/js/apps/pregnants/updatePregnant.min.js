/*!
 * auhtor: Luis Eduardo Miranda Barja
 * (C) 2015 - mbarjaedu13@gmail.com
 */
$(function(){$(".pregnant-menu").addClass("active");$("#back, .back").on({click:function(i){i.preventDefault();location.href="/embarazos/gestion?id_per="+$("input[name=id_per]").val();}});$("input[name=f_nac]").mask("99/99/9999").on({"click focusin":function(i){$(this).datetimepicker({locale:"es",format:"DD/MM/YYYY"});}});var c=$("form").data("key"),b=function(k){var m=[$('<option value="-1">-- Elija Una --</option>')];for(var n=0;n<k.length;n++){var l=k[n],j=$("<option/>",{value:l.id_etn,text:l.nombre});if(l.id_etn==c.id_etn){j.attr("selected",true);}m.push(j);}return m;},d=function(j){var k=[$('<option value="-1">-- Elija Una --</option>')];for(var l=0;l<j.length;l++){var n=j[l],m=$("<option/>",{value:n.id_red,text:n.nombre}).data("municipios",n.municipios);if(c.id_red==n.id_red){m.attr("selected",true);}k.push(m);}return k;},g=function(n){var k=[$('<option value="-1">-- Elija Uno --</option>')];for(var m=0;m<n.length;m++){var l=n[m],j=$("<option/>",{value:l.id_mup,text:l.nombre}).data("comunidades",l.comunidades);if(c.id_mup==l.id_mup){j.attr("selected",true);}k.push(j);}return k;},f=function(n){var l=[$('<option value="-1">-- Elija Uno --</option>')];for(var m=0;m<n.length;m++){var k=n[m],j=$("<option/>",{value:k.id_com,text:k.nombre});if(c.id_com==k.id_com){j.attr("selected",true);}l.push(j);}return l;};if(c.is_pregnant){$.post("/etnias/disponibles",data={_xsrf:getCookie("_xsrf")},function(i){$("#etnia").html(b(i));});$.post("/redes_salud/geografia",data={_xsrf:$("input[name=_xsrf]").val()},function(i){$("#red").html(d(i)).on({change:function(){var k=+$(this).val(),j=$(this).find('option[value="'+k+'"]').data("municipios");if(k>0){$("#municipio").html(g(j)).on({change:function(){var l=+$(this).val();if(l>0){comunidades=$(this).find('option[value="'+l+'"]').data("comunidades");$("#comunidad").html(f(comunidades));}else{$("#comunidad").html('<option value="-1">-- Elija Una --</option>');}}}).change();}else{$("#municipio").html('<option value="-1">-- Elija Uno --</option>');$("#comunidad").html('<option value="-1">-- Elija Una --</option>');}}}).change();});}else{$(".locations").disable().hide();}var h=+$("input[name=telf]").val(),a=$("input[name=c_telf]").val(),e=$("input[name=ci]").val();$("input[name=telf]").on({blur:function(j){var k=$(this),i=$(this).val();if(h!=+i&&i.length==8&&i.match(k.data("pattern"))){if(i!=a){$.post("/personas/v_telf",data={_xsrf:$("input[name=_xsrf]").val(),telf:i},function(l){if(l){k.val(h).focus().closest(".form-group").removeClass("has-success has-error");swal({title:"Error!",text:"El nro. "+i+", está registrado!.\nPor favor use otro.",type:"error",confirmButtonText:"Continuar",});}});}else{k.val(h).focus().closest(".form-group").removeClass("has-success has-error");}}}});$("input[name=c_telf]").on({keyup:function(j){var k=$(this),i=k.val();if(i.length==8&&i!=a&&i.match(k.data("pattern"))){if(i!=h){swal({title:"Advertencia!",text:"Desea cambiar de contacto?",type:"warning",showCancelButton:true,cancelButtonText:"Cancelar",confirmButtonText:"Cambiar",closeOnConfirm:true},function(){$("input[name=C_id_per]").disable();$("input[name=c_nombres], input[name=c_apellidos]").val("");});$.post("/personas/v_telf",data={_xsrf:$("input[name=_xsrf]").val(),telf:i},function(l){if(l){$("form").find(".optional").show().end().find(".contact-name").text("Contacto");$.post("/personas/getbycellphone",data={_xsrf:getCookie("_xsrf"),telf:i},function(m){if(m){$("form").find(".optional").hide().end().find(".contact-name").text(m.persona);}});}});}else{$("form").find(".optional").show().end().find(".contact-name").text("Contacto");k.val(a).focus().closest(".form-group").removeClass("has-success has-error").find("span").removeClass("fa-check fa-times");swal({title:"Error!",text:"El nro. de contacto, no puede ser igual al de la embarazada!.\nPor favor elija otro.",type:"error",confirmButtonText:"Continuar",});}}else{if(i.length==8){$("form").find(".optional").show().end().find(".contact-name").text("Contacto");k.val(a).closest(".form-group").removeClass("has-success has-error").find("span").removeClass("fa-check fa-times");}else{k.closest(".form-group").removeClass("has-success").addClass("has-error").find("span").removeClass("fa-check").addClass("fa-times");}}}});e=e.length==8?e:"";$("input[name=ci]").on({blur:function(k){var j=$(this),i=$(this).val();if(i.length>=7&&i.length<=8&&i!=e){$.post("/personas/v_ci",data={_xsrf:getCookie("_xsrf"),ci:j.val()},function(l){if(l){j.val(e).focus().closest(".form-group").removeClass("has-success has-error");swal({title:"Error!",text:"El CI: "+i+", está registrado!.\nPor favor use otro.",type:"error",confirmButtonText:"Continuar",});}else{j.closest(".form-group").removeClass("has-error").addClass("has-success").find("span").removeClass("fa-times").addClass("fa fa-check");}});}}});$("form").on({submit:function(k){k.preventDefault();k.stopPropagation();var i=$(this),j=$(this).find("button[type=submit]");j.disable().hide();$.post("/embarazadas/modificar_embarazada",data=i.form2Dict(),function(l){if(l){location.href="/embarazos/gestion?id_per="+$("input[name=id_per]").val();}else{j.enable().show();}});}});});