/*!
 * auhtor: Luis Eduardo Miranda Barja
 * (C) 2015 - mbarjaedu13@gmail.com
 */
$(function(){$(".pregnant-menu").addClass("active");$("#cancel, .back").on({click:function(f){f.preventDefault();location.href="/embarazadas/gestion";}});$("input[name=f_nac], #inputParto_prob").mask("99/99/9999").on({"click focusin":function(f){$(this).datetimepicker({locale:"es",format:"DD/MM/YYYY"});}});$.post("/etnias/disponibles",data={_xsrf:getCookie("_xsrf")},function(e){$("#inputId_etn").html(c(e));$("#inputId_etnc").html($("#inputId_etn").html());});$.post("/redes_salud/geografia",data={_xsrf:getCookie("_xsrf")},function(e){var f=['<option value="-1">-- Elija Una --</option>'];for(var g=0;g<e.length;g++){var h=e[g];f.push('<option value="'+h.id_red+"\" data-municipios='"+JSON.stringify(h.municipios)+"'>"+h.nombre+"</option>");}$("#inputRedes").html(f.join(""));});$("#inputRedes").on({change:function(m){var g=$(this),l=+$(this).val();$("#inputMunicipio").html('<option value="-1">-- Elija Uno --</option>').trigger("change");$("#inputId_com").html('<option value="-1">-- Elija Una --</option>').trigger("change");if(l!=-1){var k=g.find('option[value="'+l+'"]').data("municipios"),f=['<option value="-1">-- Elija Uno --</option>'];for(var j=0;j<k.length;j++){var h=k[j];f.push('<option value="'+h.id_mup+"\" data-comunidades='"+JSON.stringify(h.comunidades)+"'>"+h.nombre+"</option>");}$("#inputMunicipio").html(f.join(""));}}});$("#inputMunicipio").on({change:function(l){var h=$(this),k=+$(this).val();$("#inputId_com").html('<option value="-1">-- Elija Una --</option>').trigger("change");if(k!=-1){var m=h.find('option[value="'+k+'"]').data("comunidades"),g=['<option value="-1">-- Elija Una --</option>'];for(var j=0;j<m.length;j++){var f=m[j];g.push('<option value="'+f.id_com+'">'+f.nombre+"</option>");}$("#inputId_com").html(g.join(""));}}});var c=function(e){var f=['<option value="-1">-- Elija Una --</option>'];for(var g=0;g<e.length;g++){var h=e[g];f.push('<option value="'+h.id_etn+'">'+h.nombre+"</option>");}return f.join("");},a=function(e){var f=null;$.ajaxSetup({async:false});$.post("/personas/v_pregnantstelf",data={_xsrf:getCookie("_xsrf"),telf:e},function(g){f=g;});$.ajaxSetup({async:true});return f;},d=function(e){var f=null;$.ajaxSetup({async:false});$.post("/personas/v_telf",data={_xsrf:getCookie("_xsrf"),telf:e},function(g){f=g;});$.ajaxSetup({async:true});return f;},b=$(".contact-form").clone();$("#inputTelf").on({blur:function(j){var i=$(this),h=$(this).val(),g=$(this).data("pattern");$("form").find(".prg-name").text("Nueva Embarazada").end().find(".contact-name").text("Contacto");$(".contact-form").html("").html(b.html()).find("#inputId_etnc").html($("#inputId_etn").html());if(h.match(g)==null&&h.length==0){$(".prg_signal").find("select").find('option[value="1"], option[value="2"]').disable().end().find('option[value="0"]').attr("selected",true).end().trigger("change");$(".contact-form").html("").html(b.html()).find("#inputId_etnc").html($("#inputId_etn").html());}else{if(h.length==8&&$.type(+h)=="number"){var f=a(h);if(f.status==false){$(".prg_signal").find("select").find('option[value="1"]').attr("selected",true).enable().end().trigger("change");i.closest(".form-group").removeClass("has-error").addClass("has-success");}else{if(f.status==true){i.closest(".form-group").removeClass("has-error").addClass("has-success");$("form").find(".prg-name").text(f.p_data).end().find(".prg_optional").disable().find(":input").disable().end().hide().end();}else{$(".prg_signal").find("select").find('option[value="1"]').removeAttr("selected").disable().end().trigger("change");i.val("").focus();swal({title:"Error!",text:f.p_data!=null?(f.p_data+".\nEstÃ¡ registrado con el nro. "+h):"",type:"error",confirmButtonText:"Continuar",closeOnConfirm:false});}}}else{i.closest(".form-group").removeClass("has-success").addClass("has-error");}}}});$("input[name=ci]").on({blur:function(h){var g=$(this),f=g.val();if(f.length>6&&f.length<9){$.post("/personas/v_ci",data={_xsrf:getCookie("_xsrf"),ci:f},function(e){if(e){g.val("").focus().closest(".form-group").removeClass("has-success").addClass("has-error");swal({title:"Error!",text:'"'+f+'", se encuentra registrado!.\nPor favor elija otro.',type:"error",confirmButtonText:"Continuar",closeOnConfirm:false});}else{g.closest(".form-group").removeClass("has-error").addClass("has-success");}});}else{g.val("").closest(".form-group").removeClass("has-success has-error");}}});$("form").on("blur","#inputTelfc",function(j){var i=$(this).val(),h=$(this).data("pattern"),f=$(this),g=$("#inputTelf").val();if(i.match(h)!=null&&i!=g){if(d(i)==false){$("form").find(".contact-name").text("Contacto").end().find(".optional").enable().show();f.closest(".form-group").removeClass("has-error").addClass("has-success");$("#inputCoberturac").find('option[value="1"]').attr("selected",true).end().trigger("change");}else{$.post("/personas/getbycellphone",data={_xsrf:getCookie("_xsrf"),telf:i},function(e){$("form").find(".optional").disable().find(":input").disable().end().hide().end().find(".contact-name").text(e.persona);});}}else{f.val("").closest(".form-group").removeClass("has-success").addClass("has-error").find("span").removeClass("fa-check").addClass("fa-times");$("form").find(".optional").enable().find(":input").enable().end().show().end().find(".contact-name").text("Contacto");}});$("form").on("change","select",function(g){var f=$(this);if(f.val()!="-1"){f.closest(".form-group").removeClass("has-error").addClass("has-success");}else{f.closest(".form-group").removeClass("has-success").addClass("has-error");}});$("form").on({submit:function(h){h.preventDefault();h.stopPropagation();var f=$(this),g=f.find("button[type=submit]");g.disable().hide();$.post("/embarazadas/nueva_embarazada",data=f.form2Dict(),function(e){if(e){location.href="/embarazadas/gestion";}else{g.enable().show();$("#inputParto_prob").val("").focus().closest(".form-group").removeClass("has-success").addClass("has-error").find("span").removeClass("fa-check").addClass("fa-times");}});}});});