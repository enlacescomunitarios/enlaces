/*!
 * auhtor: Luis Eduardo Miranda Barja
 * (C) 2015 - mbarjaedu13@gmail.com
 */
$(function(){var c=$(".key").data("key"),o=$("button[type=submit]"),e=$("#del");$(".key").removeAttr("data-key");var f=$("#inputRol"),n=f.closest(".form-group").next(),h=$(".redes_salud"),m=$(".municipios"),a=$(".centros_salud"),i=[],k=function(r){var p=['<option value="-1">-- Elija Uno --</option>'];for(var q=0;q<r.length;q++){p.push('<option value="'+r[q].id_tip+'">'+r[q].nombre+"</option>");}return p.length>1?p.join(""):'<option value="-1">-- Sin Tipos --</option>';},d=function(){var p=['<option value="-1">-- Elija Una --</option>'],r=(+c.red_salud>0?+c.red_salud:+c.red);for(var q=0;q<i.length;q++){var s=i[q];p.push('<option value="'+s.id_red+'"'+(r==s.id_red?" selected":"")+">"+s.nombre+"</option>");}return p.length>1?p.join(""):'<option value="-1">-- Sin Redes de Salud --</option>';},l=function(t){var r=['<option value="-1">-- Elija Uno --</option>'];for(var s=0;s<i.length;s++){var v=i[s];if(v.id_red==t&&v.municipios.length>0){var q=i[s].municipios;for(var p=0;p<q.length;p++){var u=q[p];r.push('<option value="'+u.id_mup+'"'+(+c.municipio>0&&+c.municipio==u.id_mup?" selected":"")+">"+u.nombre+"</option>");}break;}}return r.length>1?r.join(""):'<option value="-1">-- Sin Municipios --</option>';},b=function(t){var q=['<option value="-1">-- Elija Uno -- </option>'];for(var s=0;s<i.length;s++){var v=i[s];if(v.id_red==t&&v.centros.length>0){var r=i[s].centros;for(var p=0;p<r.length;p++){var u=r[p];q.push('<option value="'+u.id_cen+'"'+(+c.centro_salud>0&&+c.centro_salud==u.id_cen?" selected":"")+">"+u.nombre+"</option>");}break;}}return q.length>1?q.join(""):'<option value="-1">-- Sin Establecimientos --</option>';};$.post("/redes_salud/disponibles",data={_xsrf:getCookie("_xsrf")},function(p){if($.type(p)=="array"){i=p;h.find("select").html(d());j();}});var g=$("#inputLogin").val();$("#inputLogin").on({blur:function(r){var q=$(this).val(),p=$(this);if(q.length>5&&c.login!=q){$.post("/usuarios/v_login",data={_xsrf:getCookie("_xsrf"),login:q},function(s){if(s){p.val(g).focus().closest(".form-group").removeClass("has-success").addClass("has-error");swal({title:"Error!",text:'"'+q+'", no está disponible!.\nPor favor escoja otro.',type:"error",confirmButtonText:"Continuar",closeOnConfirm:false});}else{p.closest(".form-group").removeClass("has-error").addClass("has-success");$("button[type=submit]").enable();}});}else{if(q.length==0){p.attr({placeholder:"Debe llenar éste campo..!"});}}}});f.on({change:function(p){if($(this).val()=="Operador de Registro"){n.enable().show();}else{n.disable().hide();h.find("select").html(d(i)).end().disable().hide();m.find("select").html('<option value="-1">-- Elija Uno --</option>').end().disable().hide();a.find("select").html('<option value="-1">-- Elija Uno --</option>').end().disable().hide();}}});n.find("select").on({change:function(q){var p=+$(this).val();h.find("select").html(d(i)).end().disable().hide();m.find("select").html('<option value="-1">-- Elija Uno --</option>').end().disable().hide();a.find("select").html('<option value="-1">-- Elija Uno --</option>').end().disable().hide();if(p==2){h.enable().show();}else{if(p==3){h.enable().show();m.enable().show();}else{if(p==4){h.enable().show();a.enable().show();}}}}});h.find("select").on({change:function(q){var p=+$(this).val(),r=+n.find("select").val();m.find("select").html('<option value="-1">-- Elija Uno --</option>').end().disable().hide();a.find("select").html('<option value="-1">-- Elija Uno --</option>').end().disable().hide();if(p!=-1&&r==3){m.find("select").html(l(p)).end().enable().show();}else{if(p!=-1&&r==4){a.find("select").html(b(p)).end().enable().show();}}}});var j=function(){if(+c.alcance<1){n.disable().hide();h.disable().hide();}else{if(+c.alcance>1){n.find("select").find('option[value="'+c.alcance+'"]').attr("selected",true).end();var p=(+c.red_salud>0?+c.red_salud:+c.red),q=+c.alcance;h.enable().show();if(p!=-1&&q==3){m.find("select").html(l(p)).end().enable().show();}else{if(p!=-1&&q==4){a.find("select").html(b(p)).end().enable().show();}}}else{h.disable().hide();}}if(+c.municipio<1){m.disable().hide();}if(+c.centro_salud<1){a.disable().hide();}};$("form").on({submit:function(q){q.preventDefault();q.stopPropagation();var p=$(this);o.disable().hide();e.disable().hide();$.post("/usuarios/modificar_usuario",data=p.form2Dict(),function(r){if(r){location.href="/usuarios/gestion";}else{o.enable().show();e.enable().show();}});}});e.on({click:function(p){p.preventDefault();o.disable().hide();e.disable().hide();$.post("/usuarios/eliminar_usuario",data={_xsrf:getCookie("_xsrf"),persona:$("input[name=persona]").val()},function(q){if(q==false){location.href="/usuarios/gestion";}else{o.enable().show();e.enable().show();}});}});});