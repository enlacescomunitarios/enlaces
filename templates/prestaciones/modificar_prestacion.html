{% extends "../base.html" %}
{% block header_section %}
<link href="{{ static_url("css/sweet-alert.min.css") }}" rel="stylesheet" media="all">
<script type="text/javascript" src="{{ static_url("js/shortcuts.min.js") }}"></script>
<script type="text/javascript" charset="iso-8859-1" src="{{ static_url("js/sweet-alert.min.js") }}"></script>
<script type="text/javascript">
	$(function(){
		$('.manager-menu, .capability-sub').addClass('active');
		$('.back').on({
			click:function(e){
				e.preventDefault();
				location.href='/prestaciones/gestion';
			}
		});
		var cap_name = $('#inputNombre').val(), btn_submit = $('button[type=submit]'), btn_del = $('#del');
		btn_del.on({
			click:function(e){
				e.preventDefault();
				btn_submit.disable().hide();
				btn_del.disable().hide();
				$.post(
					'/prestaciones/eliminar_prestacion',
					data = {'_xsrf':getCookie('_xsrf'),'id_pst':$('input[name=id_pst]').val()},
					function(response){
						if(!response){
							location.href='/prestaciones/gestion';
						} else{
							btn_submit.enable().show();
							btn_del.enable().show();
						}
					}
				);
			}
		});
		$('form').on({
			submit:function(e){
				e.preventDefault();
				e.stopPropagation();
				var oform = $(this);
				btn_submit.disable().hide();
				btn_del.disable().hide();
				$.post(
					'/prestaciones/modificar_prestacion',
					data = oform.form2Dict(),
					function(response){
						if(response){
							location.href='/prestaciones/gestion';
						} else{
							//alert(oform.nombre+', está registrado.\nUse otro nombre.');
							swal({
								title: "Error!",
								text: data.nombre+', está registrado. Use otro nombre.',
								type: "error",
								confirmButtonText: "Continuar"
							});
							btn_submit.enable().show();
							btn_del.enable().show();
							$('#inputNombre').val(cap_name).focus();
						}
					}
				);
			}
		});
	});
</script>
{% end %}
{% block breadcrumbs %}
<ul id="breadcrumbs" class="breadcrumb">
	<li><a href="/">Inicio</a></li>
	<li><a href="#" class="back">Prestaciones</a></li>
	<li class="active">Modificar Prestación</li>
</ul>
{% end %}
{% block left-content %}
<form>
	{% module xsrf_form_html() %}
	<input type="hidden" name="id_pst" value="{{pr.id_pst}}" readonly>
	<legend class="text-center">Modificar Prestación</legend>
	<div class="form-group has-feedback">
		<label for="inputNombre">Nombre:</label>
		<input type="text" name="nombre" value="{{pr.nombre}}" id="inputNombre" class="form-control input-sm only_g_names" required>
		<span class="form-control-feedback"></span>
	</div>
	<div class="form-group">
		<label for="inputDescrip">Descripción:</label>
		<textarea class="form-control input-sm only_comments" name="descrip" id="inputDescrip">{{pr.descrip or ''}}</textarea>
	</div>
	<div class="form-group">
		<button type="button" class="back btn btn-sm btn-warning">Regresar</button>
		{% if pr.activo %}
		<button type="button" id="del" class="btn btn-sm btn-danger">Inhabilitar</button>
		<button type="submit" class="btn btn-sm btn-primary">Actualizar</button>
		{% else %}
		<button type="submit" class="btn btn-sm btn-primary">Habilitar</button>
		{% end %}
	</div>
</form>
{% end %}