{% extends "../base.html" %}
{% block header_section %}
<style type="text/css" media="all">
	hr{border-color: #000;}
</style>
<link href="{{ static_url("css/datetimepicker.min.css") }}" rel="stylesheet" media="all">
<script type="text/javascript" src="{{ static_url("js/shortcuts.min.js") }}"></script>
<script type="text/javascript" charset="iso-8859-1" src="{{ static_url("js/moment.min.js") }}"></script>
<script type="text/javascript" src="{{ static_url("js/datetimepicker.min.js") }}"></script>
<script type="text/javascript" charset="iso-8859-1" src="{{ static_url("js/jquery.maskedinput.min.js") }}"></script>
<script type="text/javascript">
	$(function(){
		$('.pregnant-menu').addClass('active');
		$('#inputParto_inst').mask('99/99/9999').on({
			'click focusin':function(e){
				$(this).datetimepicker({
					locale: 'es',
					format: 'DD/MM/YYYY'
				});
			}
		});
		var count = 1, opreg = $('#breadcrumbs').data('key'),
			newborn_tmpl = function(numb){
				return '<hr class="newborn-'+numb+'">'+
				'<div class="row newborn-'+numb+'">'+
					'<fieldset class="form-group col-sm-6">'+
						'<label>Sexo:</label>'+
						'<select name="sexo'+numb+'" class="form-control input-sm" required>'+
							'<option value="-1">-- Elija Uno --</option>'+
							'<option value="f">Femenino</option>'+
							'<option value="m">Masculino</option>'+
						'</select>'+
					'</fieldset>'+
					'<fieldset class="form-group has-feedback col-sm-6">'+
						'<label>Peso:</label>'+
						'<div class="input-group">'+
							'<span class="input-group-addon">Kilogramo</span>'+
							'<input type="text" name="peso" class="form-control input-sm only_neonato_weight" required>'+
							'<span class="form-control-feedback"></span>'+
						'</div>'+
					'</fieldset>'+
				'</div>'+
				'<div class="row newborn-'+numb+'">'+
				'<fieldset class="form-group has-feedback col-sm-5">'+
					'<label>Nombre(s):</label>'+
					'<input type="text" name="nombres" class="form-control input-sm only_p_names">'+
					'<span class="form-control-feedback"></span>'+
				'</fieldset>'+
				'<fieldset class="form-group has-feedback col-sm-7">'+
					'<label>Apellidos:</label>'+
					'<input type="text" name="apellidos" value="'+opreg.lastname+'" class="form-control input-sm only_p_lastnames">'+
					'<span class="form-control-feedback"></span>'+
				'</fieldset>'+
				'</div>';
			};
		$('#breadcrumbs').removeAttr('data-key');
		$('.del').disable();
		$('.add').on({
			click:function(e){
				e.preventDefault();
				$('.new_born').append(newborn_tmpl(count));
				count++;
				if(count==2){
					$('.del').enable();
				}
			}
		});
		$('.del').on({
			click:function(e){
				e.preventDefault();
				count = (count > -1)?(count-1):1;
				if(count <= 1){
					$(this).disable();
				}
				$('.new_born').find('.newborn-'+count).remove();
			}
		});
		$('form').on({
			submit:function(e){
				e.preventDefault();
				e.stopPropagation();
				var oform = $(this);
				//console.log(oform.form2Dict(true));
				$.post(
					'/embarazos/reg_parto',
					data = oform.form2Dict(true),
					function(response){
						if(response){
							location.href='/embarazos/gestion?id_per='+opreg.id;
						}
					}
				);
			}
		});
		$('#back, .back').on({
			click:function(e){
				e.preventDefault();
				//location.href='/embarazos/gestion?id_per='+opreg.id;
				location.href='/controles/gestion?id_emb='+opreg.id_emb;
			}
		});
		$('.pregnant').on({
			click:function(e){
				e.preventDefault();
				location.href='/embarazos/gestion?id_per='+opreg.id;
			}
		});
	});
</script>
{% end %}
{% block breadcrumbs %}
<ul id="breadcrumbs" class="breadcrumb" data-key='{"id":{{em.embarazada.id_per}},"id_emb":{{em.id_emb}},"lastname":"{{em.embarazada.apellidos}}"}'>
	<li><a href="/">Inicio</a></li>
	<li><a href="/embarazadas/gestion">Embarazadas</a></li>
	<li><a href="#" class="pregnant">{{em.embarazada}}</a></li>
	<li><a href="#" class="back">Controles</a></li>
	<li class="active">Registro de Parto</li>
</ul>
{% end %}
{% block left-content %}
<form class="big-form">
	{% module xsrf_form_html() %}
	<input type="hidden" name="id_emb" value="{{em.id_emb}}" readonly>
	<div class="inner-container">
		<div class="left-side">
			<legend>Registro de Parto</legend>
			<div class="row">
				<fieldset class="form-group has-feedback col-sm-6">
					<label for="inputParto_inst">Fecha de Parto:</label>
					<input type="text" name="parto_inst" id="inputParto_inst" value="{{to_ddmmyy(utc.now().date())}}" class="form-control input-sm only_date" required>
					<span class="form-control-feedback"></span>
					<p class="help-block">Día/Mes/Año</p>
				</fieldset>
				<fieldset class="form-group col-sm-6">
					<label for="">Tipo de Parto:</label>
					<select name="tipo" id="inputTipo" class="form-control input-sm" required>
						<option value="-1">-- Elija Uno --</option>
						<option value="1">Institucional</option>
						<option value="2">Domiciliario</option>
					</select>
				</fieldset>
			</div>
		</div>
		<div class="right-side">
			<legend>Recién Nacido(s)&nbsp;<i class="del btn btn-danger btn-xs fa fa-times"></i>&nbsp;<i class="add btn btn-info btn-xs fa fa-plus"></i></legend>
			<div class="new_born">
				<div class="row">
					<fieldset class="form-group col-sm-6">
						<label>Sexo:</label>
						<select name="sexo0" class="form-control input-sm" required>
							<option value="-1">-- Elija Uno --</option>
							<option value="f">Femenino</option>
							<option value="m">Masculino</option>
						</select>
					</fieldset>
					<fieldset class="form-group has-feedback col-sm-6">
						<label>Peso:</label>
						<div class="input-group">
							<span class="input-group-addon">Kilogramo</span>
							<input type="text" name="peso" class="form-control input-sm only_neonato_weight" required>
							<span class="form-control-feedback"></span>
						</div>
					</fieldset>
				</div>
				<div class="row">
					<fieldset class="form-group has-feedback col-sm-5">
						<label>Nombre(s):</label>
						<input type="text" name="nombres" class="form-control input-sm only_p_names">
						<span class="form-control-feedback"></span>
					</fieldset>
					<fieldset class="form-group has-feedback col-sm-7">
						<label>Apellidos:</label>
						<input type="text" name="apellidos" value="{{em.embarazada.apellidos}}" class="form-control input-sm only_p_lastnames">
						<span class="form-control-feedback"></span>
					</fieldset>
				</div>
			</div>
		</div>
	</div>
	<fieldset class="form-group">
		<button type="button" id="back" class="btn btn-sm btn-warning">Regresar</button>
		<button type="submit" class="btn btn-sm btn-primary">Guardar</button>
	</fieldset>
</form>
{% end %}