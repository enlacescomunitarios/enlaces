{% extends "../base.html" %}
{% block header_section %}
<link href="{{ static_url("css/datetimepicker.min.css") }}" rel="stylesheet" media="all">
<style type="text/css" media="all">
	#fix{
		margin-top: -5px !important;
	}
</style>
<script type="text/javascript" src="{{ static_url("js/shortcuts.min.js") }}"></script>
<script type="text/javascript" charset="iso-8859-1" src="{{ static_url("js/moment.min.js") }}"></script>
<script type="text/javascript" src="{{ static_url("js/datetimepicker.min.js") }}"></script>
<script type="text/javascript" charset="iso-8859-1" src="{{ static_url("js/jquery.maskedinput.min.js") }}"></script>
<script type="text/javascript">
	$(function(){
		$('.pregnant-menu').addClass('active');
		var o_key = $("#breadcrumbs").data('key'), btn_submit = $('button[type=submit]'), btn_interr = $('#interr');
		$("#breadcrumbs").removeAttr('data-key');
		$('input[name=f_conf]').mask('99/99/9999').on({
			'click focusin':function(e){
				$(this).datetimepicker({
					locale:'es',
					format: 'DD/MM/YYYY'
				});
			}
		});
		$('.optional').disable();
		if(o_key.done){
			$('.right-side').disable();
		}
		$('#interr').on({
			click:function(e){
				e.preventDefault();
				btn_submit.disable().hide();
				btn_interr.disable().hide();
				$.post(
					'/embarazos/del_interr',
					data = {'_xsrf':getCookie('_xsrf'),'id_def':$('input[name=id_def]').val()},
					function(response){
						if(!response){
							location.href='/controles/gestion?id_emb='+o_key.id_emb;
						} else{
							btn_submit.enable().show();
							btn_interr.enable().show();
						}
					}
				);
			}
		});
		$('form').on({
			submit:function(e){
				e.preventDefault();
				e.stopPropagation();
				var oform = $(this);
				//console.log($(this).form2Dict());
				$.post(
					'/embarazos/conf_interr',
					data = oform.form2Dict(),
					function(response){
						if(response){
							//location.href='/embarazadas/gestion';
							location.href='/controles/gestion?id_emb='+o_key.id_emb;
						}
					}
				);
			}
		});
		$('.pregnant').on({
			click:function(e){
				e.preventDefault();
				location.href='/embarazos/gestion?id_per='+o_key.id_per;
			}
		});
		$('#back, .back').on({
			click:function(e){
				e.preventDefault();
				//location.href='/embarazadas/gestion';
				location.href='/controles/gestion?id_emb='+o_key.id_emb;
			}
		});
	});
</script>
{% end %}
{% block breadcrumbs %}
<ul id="breadcrumbs" class="breadcrumb" data-key='{"id_per":{{death.embarazo.embarazada.id_per}},"id_emb":{{death.embarazo.id_emb}},"done":{{1 if death.f_conf else 0}}}'>
	<li><a href="/">Inicio</a></li>
	<li><a href="/embarazadas/gestion">Embarazadas</a></li>
	<li><a href="#" class="pregnant">{{death.embarazo.embarazada}}</a></li>
	<li><a href="#" class="back">Controles</a></li>
	<li class="active">Interrupción del Embarazo</li>
</ul>
{% end %}
{% block left-content %}
<form class="big-form">
	{% module xsrf_form_html() %}
	<input type="hidden" name="id_def" value="{{death.id_def}}" readonly>
	<div class="inner-container">
		<div class="left-side">
			<legend>Notificación</legend>
			<div class="row optional">
				<fieldset class="form-group has-feedback col-sm-6">
					<label>Fecha de Interrupción:</label>
					<label class="form-control input-sm" disabled>{{to_ddmmyy(death.fecha)}}</label>
					<p class="help-block">Día/Mes/Año</p>
				</fieldset>
				<fieldset class="form-group has-feedback col-sm-6">
					<label>Fecha de Notificación:</label>
					<label class="form-control input-sm" disabled>{{to_ddmmyy(death.f_notf)}}</label>
					<p class="help-block">Día/Mes/Año</p>
				</fieldset>
			</div>
			<fieldset id="fix" class="form-group optional">
				<label>Observación de Notificación:</label>
				<textarea class="form-control input-sm" row="4" disabled>{{death.obs_notf}}</textarea>
			</fieldset>
			<div class="clear-fix"></div>
		</div>
		<div class="right-side">
			<legend>Confirmación</legend>
			<fieldset class="form-group has-feedback">
				<label>Fecha de Confirmación:</label>
				<input type="text" name="f_conf" value="{{to_ddmmyy(death.f_conf) if death.f_conf else to_ddmmyy(utc.now().date())}}" class="form-control input-sm only_date" required>
				<span class="form-control-feedback"></span>
				<p class="help-block">Día/Mes/Año</p>
			</fieldset>
			<fieldset class="form-group">
				<label>Observación de Notificación:</label>
				<textarea name="obs_conf" class="form-control input-sm only_comments" row="4" required>{{'{}'.format(death.obs_conf or '')}}</textarea>
			</fieldset>
			<div class="clear-fix"></div>
		</div>
	</div>
	<fieldset class="form-group">
		<button type="button" id="back" class="btn btn-sm btn-warning">Regresar</button>
		{% if not death.f_conf %}
		<button type="button" id="interr" class="btn btn-sm btn-danger">Eliminar</button>
		<button type="submit" class="btn btn-sm btn-primary">Confirmar</button>
		{% end %}
	</fieldset>
</form>
{% end %}