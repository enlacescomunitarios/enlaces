{% extends "../base.html" %}
{% block header_section %}
<link href="{{ static_url("css/dataTables.bootstrap.min.css") }}" rel="stylesheet" media="all">
<link href="{{ static_url("css/sweet-alert.min.css") }}" rel="stylesheet" media="all">
<script type="text/javascript" charset="iso-8859-1" src="{{ static_url("js/jquery.dataTables.min.js") }}"></script>
<script type="text/javascript" src="{{ static_url("js/dataTables.bootstrap.min.js") }}"></script>
<script type="text/javascript" src="{{ static_url("js/customPaginator.min.js") }}"></script>
<script type="text/javascript" src="{{ static_url("js/shortcuts.min.js") }}"></script>
<script type="text/javascript" charset="iso-8859-1" src="{{ static_url("js/sweet-alert.min.js") }}"></script>
<script type="text/javascript">
	$(function(){
		$('.manager-menu, .health-sub').addClass('active');
		var o_key = $('.breadcrumb').data('key');
		$('.edit').on({
			click:function(e){
				e.preventDefault();
				location.href='/municipios/modificar_municipio?id_mup='+o_key.mup;
			}
		});
		$('.delete').on({
			click:function(e){
				e.preventDefault();
				var o_del = $(this);
				swal({
					title: "Está seguro?",
					text: o_key.str+", será inhabilitado!",
					type: "warning",
					showCancelButton: true,
					cancelButtonText: "Cancelar",
					confirmButtonColor: "#d9534f",
					confirmButtonText: "Inhabilitar",
					closeOnConfirm: false
				}, function(){
					$.post(
						'/municipios/eliminar_municipio',
						data = {'_xsrf':getCookie('_xsrf'),'id_mup':o_key.mup},
						function(response){
							if(response==false){
								$('.status').text('Inhabilitado');
								$('.add').remove();
								o_del.remove();
								swal({
									title: "Eliminado",
									text: "El municipio \""+o_key.str+"\", fué inhabilitado.",
									type: "success",
									confirmButtonText: "Continuar"
								});
							}
						}
					);
				});
			}
		});
		$('.networks').on({
			click:function(e){
				e.preventDefault();
				location.href='/redes_salud/gestion';
			}
		});
		$('.back').on({
			click:function(e){
				e.preventDefault();
				location.href='/municipios/gestion?id_red='+o_key.red;
			}
		});
		$('.add').on({
			click:function(e){
				e.preventDefault();
				location.href='/comunidades/nueva_comunidad?id_mup='+o_key.mup;
			}
		});
		$('#custom').customPaginator({height:'auto'});
	});
</script>
{% end %}
{% block breadcrumbs %}
<ul id="breadcrumbs" class="breadcrumb" data-key='{"red":{{mup.red_salud.id_red}}, "mup":{{mup.id_mup}}, "str":"{{mup.__str__()}}"}'>
	<li><a href="/">Inicio</a></li>
	<li><a href="#" class="networks">Redes de Salud</a></li>
	<li><a href="#" class="back">Red: {{mup.red_salud}}</a></li>
	<li class="active">Municipio: {{mup}}</li>
</ul>
{% end %}
{% block left-content %}
<div class="detail-card">
	<div class="row">
		<div class="col-sm-12">
			<dl class="dl-horizontal">
				<dt>Municipio:</dt>
				<dd>{{mup}}</dd>
				<dt>Estado:</dt>
				<dd class="status">{% if mup.activo %}Habilitado{% else %}Inhabilitado{% end %}</dd>
			</dl>
		</div>
	</div>
</div>
<div class="btn-actions">
	<a href="#" class="back btn btn-sm btn-warning">Regresar</a>
	<a href="#" class="edit btn btn-sm btn-info">Editar Municipio</a>
	{% if mup.activo %}
	<a href="#" class="delete btn btn-sm btn-danger">Inhabilitar Municipio</a>
	<a href="#" class="add btn btn-sm btn-primary">Nueva Comunidad</a>
	{% end %}
</div>
<div class="fix-table">
	<table id="custom" class="table table-striped table-hover table-bordered table-condensed" width="99.8%" cellspacing="0">
		<thead>
			<tr>
				<th colspan="4" class="text-center">Comunidades del Municipio {{mup}}</th>
				<tr>
					<th>Comunidad</th>
					<th>Celular</th>
					<th>Establecimientos de Salud</th>
					<th>Estado</th>
				</tr>
			</tr>
			<tbody>
				{% for cm in mup.comunidades %}
				<tr>
					<td><a href="/centros_salud/gestion?id_com={{cm.id_com}}" title="Modificar">{{cm}}</a></td>
					<td>{{'{}'.format(cm.telf or '')}}</td>
					<td>{{len(cm.centros_salud)}}</td>
					<td class="activo">{% if cm.activo %}Habilitado{%else%}Inhabilitado{% end %}</td>
				</tr>
				{% end %}
			</tbody>
		</thead>
	</table>
</div>
{% end %}